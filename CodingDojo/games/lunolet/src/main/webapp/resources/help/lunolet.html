<!--
  #%L
  Codenjoy - it's a dojo-like platform from developers to developers.
  %%
  Copyright (C) 2018 Codenjoy
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU General Public
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/gpl-3.0.html>.
  #L%
  -->
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Lunolet — как играть? | Игры на работе</title>
    <link href="files/style.css" media="all" type="text/css" rel="stylesheet">
</head>
<body style="background-color: white;"
      class="single single-post postid-170 single-format-standard logged-in admin-bar singular one-column content customize-support">
<div id="page" class="hfeed">
    <div id="main">
        <div id="primary">
            <div id="content" role="main">
                <header class="entry-header">
                    <h1 class="entry-title">Lunolet — как играть?</h1>
                </header>

                <div class="entry-content">
                    <div class="page-restrict-output">
                        <img src="lunolet0.jpg" style="float: left; margin-right: 2em;" />
                        <p>Авторы этой игры вдохновлялись двумя примерами.
                        Во-первых, серией статей "Клуб электронных игр" в журнале "Техника-молодёжи", опубликованных в 1985 году.
                        И во-вторых, игрой "Lunar Lander", выпущенной компанией Atari в 1979 году в виде аркадного игрового автомата.</p>
                        <div style="clear: left;"></div>

                        <h2>В чем суть игры?</h2>

                        <p>Вам нужно написать программу-бота, управляющую "лунолётом".
                        Лунолёт — это небольшое транспортные средство, предназначенное для перелётов вблизи поверхности Луны.</p>

                        <img src="lunolet1.jpg" style="float: right" />

                        <p>Игра разделена на уровни.
                        Задача каждого уровня — выполнить перелёт и совершить посадку на заданной площадке.</p>

                        <p>Перелёт выполняется передачей последовательности команд, по одной команде на каждом шаге.
                            Каждая команда описывает один манёвр и содержит три параметра:
                            <ol>
                                <li>угол — наклон лунолёта от вертикальной оси, в градусах, отсчитывается по часовой стрелке,
                                    задаётся в диапазоне от -180° до 360°:<br />
                                    0° означает направление тяги вверх, 180° — вниз, 90° — вправо, -90° либо 270° — влево;</li>
                                <li>масса — количество килограмм топлива, которые нужно сжечь за время манёвра;</li>
                                <li>время — продолжительность манёвра в секундах, больше ноля.</li>
                            </ol>
                            Это означает, что лунолёт должен отклониться на заданный угол и в течение указанного времени
                            сжечь заданную массу топлива.
                        </p>

                        <p>При взлёте нужно подать команду, в результате которой лунолёт преодолеет силу тяжести и оторвётся
                        от поверхности, иначе команда будет проигнорирована.
                        Сила тяжести на поверхности Луны равна 1.62 м/с<sup>2</sup>.</p>

                        <p>В случае, когда масса оставшегося топлива меньше, чем масса заданная для манёвра,
                        используется только тот объём топлива что есть, за меньшее время, поэтому манёвр закончится раньше чем ожидалось.</p>

                        <p>Мы полагаем, что в кабине лунолёта находится реальный человек, который выдерживает ускорение до 3g,
                        но если ускорение при манёвре составило 3g или больше (3g = 3 * 9.81 = 29.43), то пилот теряет сознание,
                        двигатель при этом выключается, и некоторое время лунолёт летит без управления и без тяги.
                        Время такого полёта без сознания зависит от величины превышения предельного ускорения.</p>

                        <p>При посадке необходимо, чтобы скорость в момент касания была меньше 5 м/с.
                        Считаем что скорость до 5 м/с смогуть погасить рессоры, ну или во всяком случае пилот останется жив.
                        Превышение предельной скорости означает что пилот разбился, попытка засчитывается как неудачная.</p>

                        <h2>Математика и физика</h2>

                        <p>Система координат "математическая": ось OX направлена вправо, ось OY направлена вверх.
                        Единица по X и Y составляет один метр. 
                        Ноль по OY это условный уровень поверхности Луны
                        (но точка посадки может быть и ниже и выше нуля, зависит от рельефа).</p>

                        <p>В случае когда горизонтальная скорость нулевая, двигатель выключен, работают формулы свободного падения:
                        на лунолёт действует только сила тяжести, ускорение направлено вниз.</p>

                        <p>При свободном полёте (т.е. при выключенном двигателе) с ненулевой горизонтальной скоростью,
                        движение описывается формулами для тела, брошенного горизонтально или под углом к горизонту.
                        На лунолёт действует только сила тяготения Луны, ускорение свободного падения направлено вниз.
                        Поэтому, горизонтальная скорость остаётся постоянной, а вертикальная скорость каждую секунду уменьшается
                        на 1.62.</p>

                        <p>При работающем двигателе (параметр "масса" больше нуля), важны все три параметра — угол, масса, время.
                        Порядок расчёта такой:
                            <ol>
                                <li>Определяется расход топлива в единицу времени:<br />
                                    расход = масса / время;</li>
                                <li>Определяется ускорение:<br />
                                    ускорение = расход * скорость истечения / (сухая масса + масса топлива);<br />
                                здесь скорость истечения топлива = 3660,
                                сухая масса = 250 кг — масса лунолёта с пилотом но без топлива,
                                масса топлива — сколько осталось топлива в баках.</li>
                                <li>Ускорение очевидно направлено по заданному углу, поэтому:<br />
                                    горизонтальное ускорение = ускорение * sin(угол),<br />
                                    вертикальное ускорение = ускорение * cos(угол).</li>
                                <li>гориз. скорость после = текущая гориз. скорость + время * гориз. ускорение;<br />
                                    верт. скорость после = текущая вертик. скорость + время * верт. ускорение.</li>
                                <li>новая координата X = текущий X + среднее от (текущая гориз. скорость, гориз. скорость после);<br />
                                    новая координата Y = текущий Y + среднее от (текущая верт. скорость, верт. скорость после).</li>
                            </ol>
                        Здесь можно заметить, что при определении ускорения используется параметр "масса топлива", который
                        уменьшается за время манёвра.
                        Для того, чтобы это изменение не оказывало существенного влияния на точность расчёта,
                        весь манёвр разбивается на 1-секундные интервалы, в каждом из которых выполняется приведённый выше расчёт.
                        </p>

                        <p>После того как расчёт выполнен, мы проверяем, не пересекается ли траектория полёта с рельефом.
                        Если есть контакт, то подбирается время полёта, конечная точка которого является точкой контакта.
                        Определяется скорость в этой точке — если она меньше 5 м/с то можно считать это удачной посадкой.</p>

                        <h2>Игровое поле и команды</h2>

                        <p>Каждую секунду от сервера приходит информация об игровом поле, в формате:<br />
                        <code>board={&lt;описание игрового поля&gt;}</code>,<br />
                        где <code>&lt;описание игрового поля&gt;</code> это структура в формате JSON.<br />
                        Пример:
                        (здесь поля необязательно идут в указанном порядке, также здесь для удобства чтения вставлены дополнительные разрывы строк, пробелы и комментарии):</p>
                        <pre>
  "level": 0,			// Номер текущего уровня
  "x": 0,			// Текущее положение лунолёта по X, в метрах
  "y": 2102.177,		// Текущее положение лунолёта по Y, в метрах
  "hspeed": 0,			// Горизонтальная скорость, м/с, положительное значение означает вправо
  "vspeed": 61.454,		// Вертикальная скорость, м/с, положительное значение означает вверх
  "fuelmass": 36,		// Масса оставшегося топлива
  "target": {			// Цель, точка куда нужно сесть, координаты в метрах
    "x": 25, "y": 0
  }
  "relief": [			// Рельеф уровня, поли-линия описывающая точки рельефа, координаты в метрах
    { "x": -10000, "y": 0 },
    { "x": 10000, "y": 0 }
  ],
  "history": [			// Передвижение лунолёта при выполнении предыдущей команды, координаты в метрах
    { "x": 0, "y": 2041.192 },
    { "x": 0, "y": 2102.177 }
  ],
  "angle": 0,			// Угол при выполнении предыдущей команды, в градусах
  "time": 70,			// Время от начала уровня, секунд
  "state": "FLIGHT",		// Состояние лунолёта
                        </pre>
                        <p>Все координаты даны в метрах, время в секундах, скорости в метрах в секунду.
                        Значения координат и скоростей округлены до трёх знаков после запятой.</p>

                        <p>Состояние лунолёта (<code>state</code>):
                        <ul>
                            <li><code>START</code> — лунолёт находится на стартовой площадке (начальное состояние), необходимо дать команду, позволяющую ему
                            	преодолеть силу тяжести и взлететь;</li>
                            <li><code>FLIGHT</code> — лунолёт в полёте;</li>
                            <li><code>LANDED</code> — лунолёт совершил удачную посадку (финальное состояние);</li>
                            <li><code>CRASHED</code> — лунолёт совершил НЕудачную посадку (финальное состояние).</li>
                        </ul>
                        </p>

                        <p>После того как сервер передал клиенту состояние игрового поля, он ожидает прихода ответной команды.</p>

                        <p>Полная команда выглядит так:<br />
                            <code>message('go &lt;угол&gt;, &lt;масса&gt;, &lt;время&gt;')</code><br />
                            например, команда на взлёт со стартовой позиции может выглядеть так:<br />
                            <code>message('go 0, 0.75, 3')</code> — в течение 3-х секунд расходовать по 0.25 кг топлива в секунду, вектор тяги направлен вверх.
                        </p>
                        <p>Сокращённые команды:<br />
                            <code>UP</code> — сокращение для <code>message('go 0, 0.2, 1')</code><br />
                            <code>DOWN</code> — сокращение для <code>message('go 180, 0.1, 1')</code><br />
                            <code>LEFT</code> — сокращение для <code>message('go -90, 0.1, 1')</code><br />
                            <code>RIGHT</code> — сокращение для <code>message('go 90, 0.1, 1')</code><br />
                        </p>
                        <p>Кроме того, есть команда для возврата к началу текущего уровня: <code>message('die')</code></p>

                        <h2>Клиент и игровой экран</h2>

                        <p>Организаторы предоставляют игрокам подготовленные клиенты в исходном коде на нескольких языках:
                        Java, C# и JavaScript.</p>

                        <p>Для каждого из клиентов реализована визуализация "игрового экрана", в следующием виде:</p>
                        <img src="lunolet-screen.png" />
                        <p>Все параметры визуализации получаются из "игрового поля", полученного от сервера.
                            Вверху показана "телеметрия", текущие числовые параметры;
                            лунолёт всегда находится в центре экрана (поля <code>x</code> и <code>y</code>), изображён фигуркой синего цвета, ориентация фигурки показывает направление тяги (поле <code>angle</code>), заданное предыдущей командой;
                            зелёная линия изображает движение за время от выполнения предыдущей команды (<code>history</code>);
                            рельеф показан линией чёрного цвета (<code>relief</code>);
                            красный крестик обозначает целевую точку (<code>target</code>);
                            красная стрелка показывает направление от лунолёта на целевую точку.
                        </p>

                        <h2>Подключение к серверу</h2>

                        <p>Итак, игрок <a href="/codenjoy-contest/register?gameName=lunolet" target="_blank">
                            регистрируется на сервере</a>, указывая свой email</p>

                        <p>Далее необходимо скачать, настроить и запустить клиента, который подключается к серверу через веб-сокеты:</p>
                        <ul>
                            <li><a href="/codenjoy-contest/resources/user/lunolet-servers.zip">Java-клиент</a>, для запуска используется класс SwingClient;</li>
                            <li><a href="/codenjoy-contest/resources/user/lunolet-csharp-client.zip">C# клиент</a>;</li>
                            <li><a href="/codenjoy-contest/resources/user/lunolet-javascript-client.zip">JavaScript клиент</a>.</li>
                        </ul>
                        <p>Если в этом списке нет нужного языка, придётся написать свой клиент.</p>

                        <p>Адрес для подключения к игре на сервере http://codenjoy.com:</p>
                        <pre>ws://tetrisj.jvmhost.net:12270/codenjoy-contest/ws?user=your@email.com&code=12345678901234567890</pre>

                        <p>Адрес для подключения к игре на сервере, развернутом в локальной сети:</p>
                        <pre>ws://server_ip:8080/codenjoy-contest/ws?user=your@email.com&code=12345678901234567890</pre>

                        <p>Здесь your@email.com — имейл, указанный при регистрации на сервере,
                            a code — твой security token, его ты можешь получить из адресной
                            строки браузера после регистрации/логина.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
